{"title":"Webpack4优化之依赖包cdn加载优化","uid":"18236e9a0226f101897836af69d7e11a","slug":"Webpack4优化之依赖包cdn加载优化","date":"2022-03-04T16:00:00.000Z","updated":"2024-06-07T03:20:18.000Z","comments":true,"path":"api/articles/Webpack4优化之依赖包cdn加载优化.json","keywords":"蔡惠霖的博客，前端开发，Vue，Node.js","cover":"https://blog-1300014307.cos.ap-guangzhou.myqcloud.com/webpack.png","content":"<p>记录一下自己项目使用 cdn 加速的具体过程，就是分离外部库的包(包括 vue, vue-router, vuex 等)，尽量只保留主要逻辑</p>\n<h2 id=\"准备工作\"><a href=\"#准备工作\" class=\"headerlink\" title=\"准备工作\"></a>准备工作</h2><p>首先确定一下哪些包需要进行分离，这里我们主要 Vue 的周边库，利用 html-plugin-webpack 插件，插入到 script 标签之中</p>\n<h2 id=\"开始配置-webpack\"><a href=\"#开始配置-webpack\" class=\"headerlink\" title=\"开始配置 webpack\"></a>开始配置 webpack</h2><p>首先配置 html-webpack-plugin 和 webpack 的 externals 属性，防止打包时将要分离的库一起打包进去，这里使用 chainWebpack 插件，</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">HtmlWebpackPlugin</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&quot;html-webpack-plugin&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">config.<span class=\"title function_\">externals</span>(&#123; <span class=\"attr\">vue</span>: <span class=\"string\">&quot;Vue&quot;</span>, <span class=\"string\">&quot;vue-router&quot;</span>: <span class=\"string\">&quot;VueRouter&quot;</span>, <span class=\"attr\">vuex</span>: <span class=\"string\">&quot;Vuex&quot;</span> &#125;);</span><br><span class=\"line\">config.<span class=\"title function_\">plugin</span>(<span class=\"string\">&quot;html-webpack-plugin&quot;</span>).<span class=\"title function_\">use</span>(</span><br><span class=\"line\">  <span class=\"keyword\">new</span> <span class=\"title class_\">HtmlWebpackPlugin</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">cdnJsModule</span>: [</span><br><span class=\"line\">      <span class=\"string\">&quot;https://lib.baomitu.com/vue/3.0.7/vue.runtime.global.js&quot;</span>,</span><br><span class=\"line\">      <span class=\"string\">&quot;https://lib.baomitu.com/vue-router/4.0.4/vue-router.global.prod.js&quot;</span>,</span><br><span class=\"line\">      <span class=\"string\">&quot;https://lib.baomitu.com/vuex/4.0.0/vuex.global.prod.min.js&quot;</span>,</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    <span class=\"attr\">template</span>: <span class=\"string\">&quot;template/loading.html&quot;</span>, <span class=\"comment\">// 重写div=app</span></span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n\n<p>可以看到 htmlwebpackplugin 配置了 cdnjsModule 这个属性，后续在定制的 loading.html 模板里面写入</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">&quot;UTF-8&quot;</span> /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;viewport&quot;</span> <span class=\"attr\">content</span>=<span class=\"string\">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span></span><br><span class=\"line\">&lt;% <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i <span class=\"keyword\">in</span> htmlWebpackPlugin.<span class=\"property\">options</span>.<span class=\"property\">cdnJsModule</span>) &#123; %&gt;</span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;&lt;%= htmlWebpackPlugin.options.cdnJsModule[i] %&gt;&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span></span><br><span class=\"line\">&lt;% &#125; %&gt;</span><br><span class=\"line\">&lt;/head&gt; ...</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"打包对比-现在看看，配置前后的打包情况，可见减少了差不多-100K-左右的大小\"><a href=\"#打包对比-现在看看，配置前后的打包情况，可见减少了差不多-100K-左右的大小\" class=\"headerlink\" title=\"打包对比 现在看看，配置前后的打包情况，可见减少了差不多 100K 左右的大小\"></a>打包对比 现在看看，配置前后的打包情况，可见减少了差不多 100K 左右的大小</h2><figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 未配置前</span></span><br><span class=\"line\">server/js/chunk-vendors.3e815d2d.<span class=\"property\">js</span> <span class=\"number\">144.96</span> <span class=\"title class_\">KiB</span>   <span class=\"number\">52.24</span> <span class=\"title class_\">KiB</span></span><br><span class=\"line\">server/js/app.3ad30f1e.<span class=\"property\">js</span> <span class=\"number\">46.88</span> <span class=\"title class_\">KiB</span>        <span class=\"number\">12.06</span> <span class=\"title class_\">KiB</span></span><br><span class=\"line\"><span class=\"comment\">// 配置后</span></span><br><span class=\"line\">server/js/app.941edfa5.<span class=\"property\">js</span>   <span class=\"number\">50.58</span> <span class=\"title class_\">KiB</span> <span class=\"number\">12.30</span> <span class=\"title class_\">KiB</span></span><br><span class=\"line\">server/js/chunk-vendors.0c15f71f.<span class=\"property\">js</span>    <span class=\"number\">50.22</span> <span class=\"title class_\">KiB</span>    <span class=\"number\">18.02</span> <span class=\"title class_\">KiB</span></span><br></pre></td></tr></table></figure>\n","text":"记录一下自己项目使用 cdn 加速的具体过程，就是分离外部库的包(包括 vue, vue-router, vuex 等)，尽量只保留主要逻辑 准备工作首先确定一...","permalink":"/post/Webpack4优化之依赖包cdn加载优化","photos":[],"count_time":{"symbolsCount":"1.6k","symbolsTime":"1 mins."},"categories":[{"name":"webpack","slug":"webpack","count":2,"path":"api/categories/webpack.json"},{"name":"总结","slug":"webpack/总结","count":2,"path":"api/categories/webpack/总结.json"},{"name":"Vue","slug":"webpack/总结/Vue","count":1,"path":"api/categories/webpack/总结/Vue.json"}],"tags":[{"name":"webpack","slug":"webpack","count":2,"path":"api/tags/webpack.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C\"><span class=\"toc-text\">准备工作</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%BC%80%E5%A7%8B%E9%85%8D%E7%BD%AE-webpack\"><span class=\"toc-text\">开始配置 webpack</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%89%93%E5%8C%85%E5%AF%B9%E6%AF%94-%E7%8E%B0%E5%9C%A8%E7%9C%8B%E7%9C%8B%EF%BC%8C%E9%85%8D%E7%BD%AE%E5%89%8D%E5%90%8E%E7%9A%84%E6%89%93%E5%8C%85%E6%83%85%E5%86%B5%EF%BC%8C%E5%8F%AF%E8%A7%81%E5%87%8F%E5%B0%91%E4%BA%86%E5%B7%AE%E4%B8%8D%E5%A4%9A-100K-%E5%B7%A6%E5%8F%B3%E7%9A%84%E5%A4%A7%E5%B0%8F\"><span class=\"toc-text\">打包对比 现在看看，配置前后的打包情况，可见减少了差不多 100K 左右的大小</span></a></li></ol>","author":{"name":"谢小谢","slug":"blog-author","avatar":"https://blog-1300014307.cos.ap-guangzhou.myqcloud.com/logo24.png","link":"/","description":"Love Music, love life","socials":{"github":"https://github.com/ShuHongXie","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"记一次多页面配置后CDN配置失效问题，查看cli源码并解决问题","uid":"4ef67a396b8d10d036cface974a81940","slug":"记一次多页面配置后CDN配置失效问题，查看cli源码并解决问题","date":"2022-03-13T16:00:00.000Z","updated":"2024-06-07T03:20:18.000Z","comments":true,"path":"api/articles/记一次多页面配置后CDN配置失效问题，查看cli源码并解决问题.json","keywords":"蔡惠霖的博客，前端开发，Vue，Node.js","cover":"https://blog-1300014307.cos.ap-guangzhou.myqcloud.com/single-app.png","text":"某天的某天，产品总监突然给我一个任务，让我在主站加一个页面。由于主站之前已经是 nodeJs 了，在原有基础上进行原生页面编写费时费力，且没有很大的 SEO 需...","permalink":"/post/记一次多页面配置后CDN配置失效问题，查看cli源码并解决问题","photos":[],"count_time":{"symbolsCount":"11k","symbolsTime":"10 mins."},"categories":[{"name":"经验","slug":"经验","count":6,"path":"api/categories/经验.json"},{"name":"单页应用","slug":"经验/单页应用","count":1,"path":"api/categories/经验/单页应用.json"}],"tags":[{"name":"vue","slug":"vue","count":2,"path":"api/tags/vue.json"},{"name":"单页应用","slug":"单页应用","count":1,"path":"api/tags/单页应用.json"}],"author":{"name":"谢小谢","slug":"blog-author","avatar":"https://blog-1300014307.cos.ap-guangzhou.myqcloud.com/logo24.png","link":"/","description":"Love Music, love life","socials":{"github":"https://github.com/ShuHongXie","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"Vue3源码 实例初始化过程详解","uid":"8244f2f98fb7537fa6df6a08feffa028","slug":"Vue3源码 实例初始化过程详解","date":"2022-02-23T16:00:00.000Z","updated":"2024-06-07T03:20:18.000Z","comments":true,"path":"api/articles/Vue3源码 实例初始化过程详解.json","keywords":"蔡惠霖的博客，前端开发，Vue，Node.js","cover":"https://blog-1300014307.cos.ap-guangzhou.myqcloud.com/vue-01.jpg","text":"自己接触 Vue3 也有一段时间了 之前一直有看相关的源码，现在总结下 creatApp 到 mount 挂载中间发生了什么 下面的代码均为精简版 删掉了部分不...","permalink":"/post/Vue3源码 实例初始化过程详解","photos":[],"count_time":{"symbolsCount":"6.2k","symbolsTime":"6 mins."},"categories":[{"name":"Vue","slug":"Vue","count":6,"path":"api/categories/Vue.json"},{"name":"总结","slug":"Vue/总结","count":6,"path":"api/categories/Vue/总结.json"},{"name":"Vue源码","slug":"Vue/总结/Vue源码","count":5,"path":"api/categories/Vue/总结/Vue源码.json"}],"tags":[{"name":"Vue3","slug":"Vue3","count":2,"path":"api/tags/Vue3.json"}],"author":{"name":"谢小谢","slug":"blog-author","avatar":"https://blog-1300014307.cos.ap-guangzhou.myqcloud.com/logo24.png","link":"/","description":"Love Music, love life","socials":{"github":"https://github.com/ShuHongXie","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}