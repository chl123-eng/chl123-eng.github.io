{"title":"uni-app实现京东canvas拍照识图功能","uid":"b2c8fccb8cb0e13a9e85ff1f7f24091a","slug":"uni-app实现京东canvas拍照识图功能","date":"2021-11-13T16:00:00.000Z","updated":"2024-06-07T03:20:18.000Z","comments":true,"path":"api/articles/uni-app实现京东canvas拍照识图功能.json","keywords":"蔡惠霖的博客，前端开发，Vue，Node.js","cover":"https://www.xiesmallxie.cn/20210609102048.jpeg?imageMogr2/thumbnail/!50p","content":"<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>最近公司出了一个新的功能模块(如下图)，大提上可以描述为实现拍照完上传图片，拖动四方框拍照完成上传功能，大体样子如下图。但是我找遍了 dcloud 插件市场，找到的插件都是移动背景图片来实现裁剪的，跟京东的功能是相反的，没办法只能自己来实现这么一个插件。</p></blockquote>\n<p><img src=\"https://www.xiesmallxie.cn/20210609102048.jpeg?imageMogr2/thumbnail/!50p\"></p>\n<h2 id=\"第一步\"><a href=\"#第一步\" class=\"headerlink\" title=\"第一步\"></a>第一步</h2><p>首先就需要实现一个四方框的功能了。从上图可知，四方框有一下几个特点</p>\n<ol>\n<li>四个角粘连外框，随着框的大小和移动范围紧缚移动</li>\n<li>四方框可随意四个方向拖动</li>\n<li>方框外区域阴影不影响方框内</li>\n</ol>\n<p>那么我们根据这个特性来实现下这个功能，对于 css 规范的话使用 bem 规范</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;clip__content&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">v-for</span>=<span class=\"string\">&quot;(item, index) in 4&quot;</span> <span class=\"attr\">:key</span>=<span class=\"string\">&quot;index&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;clip__edge&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight scss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$edge-border-width</span>: <span class=\"number\">6</span>rpx;</span><br><span class=\"line\"><span class=\"selector-class\">.clip</span> &#123;</span><br><span class=\"line\">  &amp;__content &#123;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: fixed;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">400</span>rpx;</span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">400</span>rpx;</span><br><span class=\"line\">    <span class=\"attribute\">left</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"attribute\">top</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"attribute\">border</span>: <span class=\"number\">1px</span> solid red;</span><br><span class=\"line\">    <span class=\"attribute\">z-index</span>: <span class=\"number\">4</span>;</span><br><span class=\"line\">    <span class=\"attribute\">overflow</span>: hidden;</span><br><span class=\"line\">    <span class=\"attribute\">box-shadow</span>: <span class=\"built_in\">rgba</span>(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0.5</span>) <span class=\"number\">0</span> <span class=\"number\">0</span> <span class=\"number\">0</span> <span class=\"number\">200vh</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  &amp;__edge &#123;</span><br><span class=\"line\">    <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">    <span class=\"attribute\">width</span>: <span class=\"number\">34</span>rpx;</span><br><span class=\"line\">    <span class=\"attribute\">height</span>: <span class=\"number\">34</span>rpx;</span><br><span class=\"line\">    <span class=\"attribute\">border</span>: <span class=\"number\">10</span>rpx solid red;</span><br><span class=\"line\">    <span class=\"attribute\">pointer-events</span>: auto;</span><br><span class=\"line\">    <span class=\"attribute\">z-index</span>: <span class=\"number\">2</span>;</span><br><span class=\"line\">    &amp;<span class=\"selector-pseudo\">::before</span> &#123;</span><br><span class=\"line\">      <span class=\"attribute\">content</span>: <span class=\"string\">&quot;</span></span><br><span class=\"line\"><span class=\"string\">&quot;</span></span><br><span class=\"line\">;</span><br><span class=\"line\">      <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">      <span class=\"attribute\">z-index</span>: <span class=\"number\">2</span>;</span><br><span class=\"line\">      <span class=\"attribute\">width</span>: <span class=\"number\">40</span>rpx;</span><br><span class=\"line\">      <span class=\"attribute\">height</span>: <span class=\"number\">40</span>rpx;</span><br><span class=\"line\">      <span class=\"attribute\">background-color</span>: transparent;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    &amp;<span class=\"selector-pseudo\">:nth-child</span>(<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">      <span class=\"attribute\">left</span>: <span class=\"variable\">$edge-border-width</span>;</span><br><span class=\"line\">      <span class=\"attribute\">top</span>: <span class=\"variable\">$edge-border-width</span>;</span><br><span class=\"line\">      <span class=\"attribute\">border-bottom-width</span>: <span class=\"number\">0</span> <span class=\"meta\">!important</span>;</span><br><span class=\"line\">      <span class=\"attribute\">border-right-width</span>: <span class=\"number\">0</span> <span class=\"meta\">!important</span>;</span><br><span class=\"line\">      &amp;<span class=\"selector-pseudo\">:before</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">top</span>: -<span class=\"number\">50%</span>;</span><br><span class=\"line\">        <span class=\"attribute\">left</span>: -<span class=\"number\">50%</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    &amp;<span class=\"selector-pseudo\">:nth-child</span>(<span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">      <span class=\"attribute\">right</span>: <span class=\"variable\">$edge-border-width</span>;</span><br><span class=\"line\">      <span class=\"attribute\">top</span>: <span class=\"variable\">$edge-border-width</span>;</span><br><span class=\"line\">      <span class=\"attribute\">border-bottom-width</span>: <span class=\"number\">0</span> <span class=\"meta\">!important</span>;</span><br><span class=\"line\">      <span class=\"attribute\">border-left-width</span>: <span class=\"number\">0</span> <span class=\"meta\">!important</span>;</span><br><span class=\"line\">      &amp;<span class=\"selector-pseudo\">:before</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">top</span>: -<span class=\"number\">50%</span>;</span><br><span class=\"line\">        <span class=\"attribute\">left</span>: <span class=\"number\">50%</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    &amp;<span class=\"selector-pseudo\">:nth-child</span>(<span class=\"number\">3</span>) &#123;</span><br><span class=\"line\">      <span class=\"attribute\">left</span>: <span class=\"variable\">$edge-border-width</span>;</span><br><span class=\"line\">      <span class=\"attribute\">bottom</span>: <span class=\"variable\">$edge-border-width</span>;</span><br><span class=\"line\">      <span class=\"attribute\">border-top-width</span>: <span class=\"number\">0</span> <span class=\"meta\">!important</span>;</span><br><span class=\"line\">      <span class=\"attribute\">border-right-width</span>: <span class=\"number\">0</span> <span class=\"meta\">!important</span>;</span><br><span class=\"line\">      &amp;<span class=\"selector-pseudo\">:before</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">bottom</span>: -<span class=\"number\">50%</span>;</span><br><span class=\"line\">        <span class=\"attribute\">left</span>: -<span class=\"number\">50%</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    &amp;<span class=\"selector-pseudo\">:nth-child</span>(<span class=\"number\">4</span>) &#123;</span><br><span class=\"line\">      <span class=\"attribute\">right</span>: <span class=\"variable\">$edge-border-width</span>;</span><br><span class=\"line\">      <span class=\"attribute\">bottom</span>: <span class=\"variable\">$edge-border-width</span>;</span><br><span class=\"line\">      <span class=\"attribute\">border-top-width</span>: <span class=\"number\">0</span> <span class=\"meta\">!important</span>;</span><br><span class=\"line\">      <span class=\"attribute\">border-left-width</span>: <span class=\"number\">0</span> <span class=\"meta\">!important</span>;</span><br><span class=\"line\">      &amp;<span class=\"selector-pseudo\">:before</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">bottom</span>: -<span class=\"number\">50%</span>;</span><br><span class=\"line\">        <span class=\"attribute\">left</span>: <span class=\"number\">50%</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n<p>根据上面的 html 和 css 出来的样式大概如下图 外部的阴影效果我们用： <strong>box-shadow: rgba(0, 0, 0, 0.5) 0 0 0 200vh 来达成</strong></p>\n<p><img src=\"https://www.xiesmallxie.cn/20210609102046.png\"></p>\n<h2 id=\"第二步\"><a href=\"#第二步\" class=\"headerlink\" title=\"第二步\"></a>第二步</h2><p>第二步的话就要实现移动功能了，这里是一个比较考验耐心的地方，因为涉及到多个方向的变化，需要不断地进行调试，在此之前需要先分析下四个角变化的特性，下面先看 4 个角的移动特性(以 H5 思维)</p>\n<ol>\n<li>第一个角的移动会改变方框的 left，top，width，right4 个值</li>\n<li>第二个角的移动会改变方框的 top，with，height3 个值</li>\n<li>第三个角的移动会改变方框的 left, width，height3 个值</li>\n<li>第四个角的移动会改变方框的 width，height2 个值</li>\n<li>四个角的移动都不能小于 4 个角的宽高，四个角的移动都不能超过屏幕，相应的逻辑需要做一下限制</li>\n</ol>\n<p><img src=\"https://www.xiesmallxie.cn/20210609102047.png\"></p>\n<p>首先需要获取下屏幕宽度，区域高度(因为头部可能会有导航栏目占位，所以不拿屏幕高度)，四方框初始宽高,</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">uni.<span class=\"title function_\">getSystemInfo</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">success</span>: <span class=\"function\">(<span class=\"params\">res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(res);</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">systemInfo</span> = res;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">uni</span><br><span class=\"line\">  .<span class=\"title function_\">createSelectorQuery</span>()</span><br><span class=\"line\">  .<span class=\"title function_\">select</span>(<span class=\"string\">&quot;.clip__content&quot;</span>)</span><br><span class=\"line\">  .<span class=\"title function_\">fields</span>(&#123; <span class=\"attr\">size</span>: <span class=\"literal\">true</span> &#125;, <span class=\"function\">(<span class=\"params\">data</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">width</span> = data.<span class=\"property\">width</span>;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">height</span> = data.<span class=\"property\">height</span>;</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  .<span class=\"title function_\">exec</span>();</span><br><span class=\"line\">uni</span><br><span class=\"line\">  .<span class=\"title function_\">createSelectorQuery</span>()</span><br><span class=\"line\">  .<span class=\"title function_\">select</span>(<span class=\"string\">&quot;.clip&quot;</span>)</span><br><span class=\"line\">  .<span class=\"title function_\">fields</span>(&#123; <span class=\"attr\">size</span>: <span class=\"literal\">true</span> &#125;, <span class=\"function\">(<span class=\"params\">data</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">screenHeight</span> = data.<span class=\"property\">height</span>;</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  .<span class=\"title function_\">exec</span>();</span><br></pre></td></tr></table></figure>\n\n<p>后续的话就可以进行四个角拖拽了，这里用到了 touchStart 和 touchMove,动态地为方框绑定样式</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span></span></span><br><span class=\"line\"><span class=\"tag\">  <span class=\"attr\">v-for</span>=<span class=\"string\">&quot;(item, index) in 4&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">  <span class=\"attr\">class</span>=<span class=\"string\">&quot;clip__edge&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">  @<span class=\"attr\">touchstart.stop.prevent</span>=<span class=\"string\">&quot;edgeTouchStart&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">  @<span class=\"attr\">touchmove.stop.prevent</span>=<span class=\"string\">&quot;e =&gt; edgeTouchMove(e, index)&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">  @<span class=\"attr\">touchend.stop.prevent</span>=<span class=\"string\">&quot;edgeTouchEnd&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>接下来开始写逻辑</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">edgeTouchStart</span>(<span class=\"params\">e</span>) &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 记录坐标xy初始位置</span></span><br><span class=\"line\">  <span class=\"variable language_\">this</span>.<span class=\"property\">clientX</span> = e.<span class=\"property\">changedTouches</span>[<span class=\"number\">0</span>].<span class=\"property\">clientX</span>;</span><br><span class=\"line\">  <span class=\"variable language_\">this</span>.<span class=\"property\">clientY</span> = e.<span class=\"property\">changedTouches</span>[<span class=\"number\">0</span>].<span class=\"property\">clientY</span>;</span><br><span class=\"line\">&#125;,</span><br><span class=\"line\"><span class=\"title function_\">edgeTouchMove</span>(<span class=\"params\">e, index</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> currX = e.<span class=\"property\">changedTouches</span>[<span class=\"number\">0</span>].<span class=\"property\">clientX</span>;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> currY = e.<span class=\"property\">changedTouches</span>[<span class=\"number\">0</span>].<span class=\"property\">clientY</span>;</span><br><span class=\"line\">  <span class=\"comment\">// 记录坐标差</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> moveX = currX - <span class=\"variable language_\">this</span>.<span class=\"property\">clientX</span>;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> moveY = currY - <span class=\"variable language_\">this</span>.<span class=\"property\">clientY</span>;</span><br><span class=\"line\">  <span class=\"comment\">// 更新坐标位置</span></span><br><span class=\"line\">  <span class=\"variable language_\">this</span>.<span class=\"property\">clientX</span> = currX;</span><br><span class=\"line\">  <span class=\"variable language_\">this</span>.<span class=\"property\">clientY</span> = currY;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> &#123; width, height, left, top, screenHeight &#125; = <span class=\"variable language_\">this</span>;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> &#123; screenWidth &#125; = <span class=\"variable language_\">this</span>.<span class=\"property\">systemInfo</span>;</span><br><span class=\"line\">  <span class=\"comment\">// 初始化最大宽高</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> maxWidth = <span class=\"number\">0</span>,</span><br><span class=\"line\">    maxHeight = <span class=\"number\">0</span>,</span><br><span class=\"line\">    maxTop = top + moveY &lt; <span class=\"number\">0</span> ? <span class=\"number\">0</span> : top + moveY,</span><br><span class=\"line\">    maxLeft = left + moveX &lt; <span class=\"number\">0</span> ? <span class=\"number\">0</span> : left + moveX;</span><br><span class=\"line\">  <span class=\"comment\">// 四个角的宽高限制</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (index % <span class=\"number\">2</span> === <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">    maxWidth = width - moveX &gt; screenWidth ? screenWidth : width - moveX;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    maxWidth = width + moveX &gt; screenWidth ? screenWidth : width + moveX;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (index &lt; <span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">    maxHeight =</span><br><span class=\"line\">      height - moveY &gt; screenHeight ? screenHeight : height - moveY;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    maxHeight =</span><br><span class=\"line\">      height + moveY &gt; screenHeight ? screenHeight : height + moveY;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 四个角的规则计算逻辑 四边方框暂定40 更详细的要用.createSelectorQuery()去拿</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (index === <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (width - moveX &lt;= <span class=\"number\">40</span> || height - moveY &lt;= <span class=\"number\">40</span>) <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(maxLeft);</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">clipStyle</span> = &#123;</span><br><span class=\"line\">      <span class=\"attr\">width</span>: maxWidth,</span><br><span class=\"line\">      <span class=\"attr\">height</span>: maxHeight,</span><br><span class=\"line\">      <span class=\"attr\">left</span>: maxLeft,</span><br><span class=\"line\">      <span class=\"attr\">top</span>: maxTop,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">width</span> = maxWidth;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">height</span> = maxHeight;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">top</span> = maxTop;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">left</span> = maxLeft;</span><br><span class=\"line\">    <span class=\"comment\">// 右上角</span></span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (index === <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (width + moveX &lt;= <span class=\"number\">40</span> || height - moveY &lt;= <span class=\"number\">40</span>) <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">clipStyle</span> = &#123;</span><br><span class=\"line\">      <span class=\"attr\">width</span>: maxWidth,</span><br><span class=\"line\">      <span class=\"attr\">height</span>: maxHeight,</span><br><span class=\"line\">      left,</span><br><span class=\"line\">      <span class=\"attr\">top</span>: maxTop,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">width</span> = maxWidth;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">height</span> = maxHeight;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">top</span> = maxTop;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (index === <span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (width - moveX &lt;= <span class=\"number\">40</span> || height + moveY &lt;= <span class=\"number\">40</span>) <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">clipStyle</span> = &#123;</span><br><span class=\"line\">      <span class=\"attr\">width</span>: maxWidth,</span><br><span class=\"line\">      <span class=\"attr\">height</span>: maxHeight,</span><br><span class=\"line\">      <span class=\"attr\">left</span>: maxLeft,</span><br><span class=\"line\">      top,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">width</span> = maxWidth;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">height</span> = maxHeight;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">left</span> = maxLeft;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (index === <span class=\"number\">3</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (width + moveX &lt;= <span class=\"number\">40</span> || height + moveY &lt;= <span class=\"number\">40</span>) <span class=\"keyword\">return</span>;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">clipStyle</span> = &#123;</span><br><span class=\"line\">      <span class=\"attr\">width</span>: maxWidth,</span><br><span class=\"line\">      <span class=\"attr\">height</span>: maxHeight,</span><br><span class=\"line\">      left,</span><br><span class=\"line\">      top,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">width</span> = maxWidth;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">height</span> = maxHeight;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>效果如下图</p>\n<p><img src=\"https://www.xiesmallxie.cn/20210609102021.gif\"></p>\n<h2 id=\"第三步\"><a href=\"#第三步\" class=\"headerlink\" title=\"第三步\"></a>第三步</h2><p>四个角拖拽逻辑完善之后，下一步目标就是做四方框的拖拽，这边需要对四方框的拖拽做一次限制</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span></span></span><br><span class=\"line\"><span class=\"tag\">  <span class=\"attr\">class</span>=<span class=\"string\">&quot;clip__content&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">  <span class=\"attr\">:style</span>=<span class=\"string\">&quot;style&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">  @<span class=\"attr\">touchstart.stop.prevent</span>=<span class=\"string\">&quot;clipTouchStart&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">  @<span class=\"attr\">touchmove.stop.prevent</span>=<span class=\"string\">&quot;clipTouchMove&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">&gt;</span></span><br><span class=\"line\">  ...</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">clipTouchStart</span>(<span class=\"params\">e</span>) &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">this</span>.<span class=\"property\">touchX</span> = e.<span class=\"property\">changedTouches</span>[<span class=\"number\">0</span>].<span class=\"property\">pageX</span>;</span><br><span class=\"line\">  <span class=\"variable language_\">this</span>.<span class=\"property\">touchY</span> = e.<span class=\"property\">changedTouches</span>[<span class=\"number\">0</span>].<span class=\"property\">pageY</span>;</span><br><span class=\"line\">&#125;,</span><br><span class=\"line\"><span class=\"title function_\">clipTouchMove</span>(<span class=\"params\">e</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> &#123; screenWidth &#125; = <span class=\"variable language_\">this</span>.<span class=\"property\">systemInfo</span>;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> currX = e.<span class=\"property\">changedTouches</span>[<span class=\"number\">0</span>].<span class=\"property\">pageX</span>;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> currY = e.<span class=\"property\">changedTouches</span>[<span class=\"number\">0</span>].<span class=\"property\">pageY</span>;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> moveX = currX - <span class=\"variable language_\">this</span>.<span class=\"property\">touchX</span>;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> moveY = currY - <span class=\"variable language_\">this</span>.<span class=\"property\">touchY</span>;</span><br><span class=\"line\">  <span class=\"variable language_\">this</span>.<span class=\"property\">touchX</span> = currX;</span><br><span class=\"line\">  <span class=\"variable language_\">this</span>.<span class=\"property\">touchY</span> = currY;</span><br><span class=\"line\">  <span class=\"comment\">// 边框限制逻辑</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"variable language_\">this</span>.<span class=\"property\">left</span> + moveX &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">left</span> = <span class=\"number\">0</span>;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (<span class=\"variable language_\">this</span>.<span class=\"property\">left</span> + moveX &gt; screenWidth - <span class=\"variable language_\">this</span>.<span class=\"property\">width</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">left</span> = screenWidth - <span class=\"variable language_\">this</span>.<span class=\"property\">width</span>;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">left</span> = <span class=\"variable language_\">this</span>.<span class=\"property\">left</span> + moveX;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"variable language_\">this</span>.<span class=\"property\">top</span> + moveY &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">top</span> = <span class=\"number\">0</span>;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (<span class=\"variable language_\">this</span>.<span class=\"property\">top</span> + moveY &gt; <span class=\"variable language_\">this</span>.<span class=\"property\">screenHeight</span> - <span class=\"variable language_\">this</span>.<span class=\"property\">height</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">top</span> = <span class=\"variable language_\">this</span>.<span class=\"property\">screenHeight</span> - <span class=\"variable language_\">this</span>.<span class=\"property\">height</span>;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">top</span> = <span class=\"variable language_\">this</span>.<span class=\"property\">top</span> + moveY;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"variable language_\">this</span>.<span class=\"property\">clipStyle</span> = &#123;</span><br><span class=\"line\">    ...<span class=\"variable language_\">this</span>.<span class=\"property\">clipStyle</span>,</span><br><span class=\"line\">    <span class=\"attr\">left</span>: <span class=\"variable language_\">this</span>.<span class=\"property\">left</span>,</span><br><span class=\"line\">    <span class=\"attr\">top</span>: <span class=\"variable language_\">this</span>.<span class=\"property\">top</span>,</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;,</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>效果如下图：</p>\n<p><img src=\"https://www.xiesmallxie.cn/20210609102022.gif\"></p>\n<h2 id=\"第四步就是做我们的截图了，这里用到了-canvas\"><a href=\"#第四步就是做我们的截图了，这里用到了-canvas\" class=\"headerlink\" title=\"第四步就是做我们的截图了，这里用到了 canvas\"></a>第四步就是做我们的截图了，这里用到了 canvas</h2><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;clip__content&quot;</span>&gt;</span></span><br><span class=\"line\">  ...</span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">canvas</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;clip-canvas&quot;</span> <span class=\"attr\">canvas-id</span>=<span class=\"string\">&quot;clip-canvas&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">canvas</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>逻辑的话目前这个例子是使用了网络的 url 图片 所以要进行 download，如果是不用网络图片，那么这一句可以删除换成其他的获取图片 api</p></blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">initCanvas</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  uni.<span class=\"title function_\">showLoading</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">title</span>: <span class=\"string\">&quot;加载中...&quot;</span>,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">  uni</span><br><span class=\"line\">    .<span class=\"title function_\">createSelectorQuery</span>()</span><br><span class=\"line\">    .<span class=\"title function_\">select</span>(<span class=\"string\">&quot;.clip__content&quot;</span>)</span><br><span class=\"line\">    .<span class=\"title function_\">fields</span>(</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"attr\">size</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"attr\">scrollOffset</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"attr\">rect</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"attr\">context</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"attr\">computedStyle</span>: [<span class=\"string\">&quot;transform&quot;</span>, <span class=\"string\">&quot;translateX&quot;</span>],</span><br><span class=\"line\">        <span class=\"attr\">scrollOffset</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      <span class=\"function\">(<span class=\"params\">data</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        uni.<span class=\"title function_\">downloadFile</span>(&#123;</span><br><span class=\"line\">          <span class=\"attr\">url</span>: <span class=\"variable language_\">this</span>.<span class=\"property\">imageUrl</span>,</span><br><span class=\"line\">          <span class=\"attr\">success</span>: <span class=\"function\">(<span class=\"params\">res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">            <span class=\"variable language_\">this</span>.<span class=\"property\">canvasInstance</span> = uni.<span class=\"title function_\">createCanvasContext</span>(</span><br><span class=\"line\">              <span class=\"string\">&quot;clip-canvas&quot;</span>,</span><br><span class=\"line\">              <span class=\"variable language_\">this</span></span><br><span class=\"line\">            );</span><br><span class=\"line\">            <span class=\"variable language_\">this</span>.<span class=\"property\">canvasInstance</span>.<span class=\"title function_\">drawImage</span>(</span><br><span class=\"line\">              res.<span class=\"property\">tempFilePath</span>,</span><br><span class=\"line\">              -data.<span class=\"property\">left</span>,</span><br><span class=\"line\">              -data.<span class=\"property\">top</span>,</span><br><span class=\"line\">              <span class=\"variable language_\">this</span>.<span class=\"property\">systemInfo</span>.<span class=\"property\">screenWidth</span>,</span><br><span class=\"line\">              <span class=\"variable language_\">this</span>.<span class=\"property\">screenHeight</span>,</span><br><span class=\"line\">              <span class=\"number\">0</span>,</span><br><span class=\"line\">              <span class=\"number\">0</span></span><br><span class=\"line\">            );</span><br><span class=\"line\">            <span class=\"variable language_\">this</span>.<span class=\"property\">canvasInstance</span>.<span class=\"title function_\">draw</span>(</span><br><span class=\"line\">              <span class=\"literal\">false</span>,</span><br><span class=\"line\">              (<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">                <span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">                  uni.<span class=\"title function_\">canvasToTempFilePath</span>(</span><br><span class=\"line\">                    &#123;</span><br><span class=\"line\">                      <span class=\"attr\">x</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">                      <span class=\"attr\">y</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">                      <span class=\"attr\">width</span>: data.<span class=\"property\">width</span>,</span><br><span class=\"line\">                      <span class=\"attr\">height</span>: data.<span class=\"property\">height</span>,</span><br><span class=\"line\">                      <span class=\"attr\">dWidth</span>: data.<span class=\"property\">width</span>,</span><br><span class=\"line\">                      <span class=\"attr\">dHeight</span>: data.<span class=\"property\">height</span>,</span><br><span class=\"line\">                      <span class=\"attr\">fileType</span>: <span class=\"string\">&quot;jpg&quot;</span>,</span><br><span class=\"line\">                      <span class=\"attr\">canvasId</span>: <span class=\"string\">&quot;clip-canvas&quot;</span>,</span><br><span class=\"line\">                      <span class=\"attr\">success</span>: <span class=\"function\">(<span class=\"params\">data</span>) =&gt;</span> &#123;</span><br><span class=\"line\">                        uni.<span class=\"title function_\">hideLoading</span>();</span><br><span class=\"line\">                        <span class=\"variable language_\">this</span>.<span class=\"property\">url</span> = data.<span class=\"property\">tempFilePath</span>;</span><br><span class=\"line\">                        <span class=\"comment\">// this.canvasInstance.save();</span></span><br><span class=\"line\">                      &#125;,</span><br><span class=\"line\">                    &#125;,</span><br><span class=\"line\">                    <span class=\"variable language_\">this</span></span><br><span class=\"line\">                  );</span><br><span class=\"line\">                &#125;, <span class=\"number\">500</span>);</span><br><span class=\"line\">              &#125;)()</span><br><span class=\"line\">            );</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    )</span><br><span class=\"line\">    .<span class=\"title function_\">exec</span>();</span><br><span class=\"line\">&#125;,</span><br></pre></td></tr></table></figure>\n\n<p>效果如图所示：</p>\n<p><img src=\"https://www.xiesmallxie.cn/20210609102020.gif\"></p>\n<p><strong>最后，我们的插件就正式完成了</strong></p>\n<p>具体代码可以看这个仓库<a href=\"https://github.com/ShuHongXie/uni-move-clip\"><code>链接</code></a>，有什么问题可以在下方留言</p>\n","text":" 最近公司出了一个新的功能模块(如下图)，大提上可以描述为实现拍照完上传图片，拖动四方框拍照完成上传功能，大体样子如下图。但是我找遍了 dcloud 插件市场，...","permalink":"/post/uni-app实现京东canvas拍照识图功能","photos":[],"count_time":{"symbolsCount":"9.6k","symbolsTime":"9 mins."},"categories":[{"name":"uni-app","slug":"uni-app","count":3,"path":"api/categories/uni-app.json"}],"tags":[{"name":"uni-app","slug":"uni-app","count":4,"path":"api/tags/uni-app.json"},{"name":"canvas","slug":"canvas","count":3,"path":"api/tags/canvas.json"},{"name":"微信小程序","slug":"微信小程序","count":2,"path":"api/tags/微信小程序.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E7%AC%AC%E4%B8%80%E6%AD%A5\"><span class=\"toc-text\">第一步</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E7%AC%AC%E4%BA%8C%E6%AD%A5\"><span class=\"toc-text\">第二步</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E7%AC%AC%E4%B8%89%E6%AD%A5\"><span class=\"toc-text\">第三步</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E7%AC%AC%E5%9B%9B%E6%AD%A5%E5%B0%B1%E6%98%AF%E5%81%9A%E6%88%91%E4%BB%AC%E7%9A%84%E6%88%AA%E5%9B%BE%E4%BA%86%EF%BC%8C%E8%BF%99%E9%87%8C%E7%94%A8%E5%88%B0%E4%BA%86-canvas\"><span class=\"toc-text\">第四步就是做我们的截图了，这里用到了 canvas</span></a></li></ol>","author":{"name":"谢小谢","slug":"blog-author","avatar":"https://blog-1300014307.cos.ap-guangzhou.myqcloud.com/logo24.png","link":"/","description":"Love Music, love life","socials":{"github":"https://github.com/ShuHongXie","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"Vue2.6源码解析之数据更新队列和nextTick方法解析","uid":"4d925ea8030231a2d81ae35ccafce2c7","slug":"Vue2.6源码解析之数据更新队列和nextTick方法解析2021-11-24","date":"2021-11-23T16:00:00.000Z","updated":"2024-06-07T03:20:18.000Z","comments":true,"path":"api/articles/Vue2.6源码解析之数据更新队列和nextTick方法解析2021-11-24.json","keywords":"蔡惠霖的博客，前端开发，Vue，Node.js","cover":"https://blog-1300014307.cos.ap-guangzhou.myqcloud.com/vue-01.jpg","text":"用了这么久的 Vue，我们都可以从官网上面知道，Vue 在更新 DOM 时是异步执行的,Vue 将开启一个队列，缓冲在同一事件循环中发生的所有数据变更,如果同一...","permalink":"/post/Vue2.6源码解析之数据更新队列和nextTick方法解析2021-11-24","photos":[],"count_time":{"symbolsCount":"8.4k","symbolsTime":"8 mins."},"categories":[{"name":"Vue","slug":"Vue","count":6,"path":"api/categories/Vue.json"},{"name":"总结","slug":"Vue/总结","count":6,"path":"api/categories/Vue/总结.json"},{"name":"Vue源码","slug":"Vue/总结/Vue源码","count":5,"path":"api/categories/Vue/总结/Vue源码.json"}],"tags":[{"name":"Vue","slug":"Vue","count":8,"path":"api/tags/Vue.json"}],"author":{"name":"谢小谢","slug":"blog-author","avatar":"https://blog-1300014307.cos.ap-guangzhou.myqcloud.com/logo24.png","link":"/","description":"Love Music, love life","socials":{"github":"https://github.com/ShuHongXie","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"懂表帝项目阶段性总结","uid":"c583867df2db339c8477f09807897308","slug":"懂表帝项目阶段性总结","date":"2021-09-02T16:00:00.000Z","updated":"2024-06-07T03:20:18.000Z","comments":true,"path":"api/articles/懂表帝项目阶段性总结.json","keywords":"蔡惠霖的博客，前端开发，Vue，Node.js","cover":"https://blog-1300014307.cos.ap-guangzhou.myqcloud.com/dbd1.jpg","text":"uni-app 懂表帝小程序 v2.1.0 已经发布上线，现在针对里面遇到的一些小问题做一下阶段性的复盘 安卓 P30 下点击 input 框聚焦后点击其他 d...","permalink":"/post/懂表帝项目阶段性总结","photos":[],"count_time":{"symbolsCount":"1.2k","symbolsTime":"1 mins."},"categories":[{"name":"uni-app","slug":"uni-app","count":3,"path":"api/categories/uni-app.json"}],"tags":[{"name":"uni-app","slug":"uni-app","count":4,"path":"api/tags/uni-app.json"},{"name":"懂表帝","slug":"懂表帝","count":1,"path":"api/tags/懂表帝.json"}],"author":{"name":"谢小谢","slug":"blog-author","avatar":"https://blog-1300014307.cos.ap-guangzhou.myqcloud.com/logo24.png","link":"/","description":"Love Music, love life","socials":{"github":"https://github.com/ShuHongXie","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}