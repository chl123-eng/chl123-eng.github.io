{"title":"uniapp下小程序获取详细定位","uid":"2ea9c9ee829119d28adc607282fb8e16","slug":"uniapp下小程序获取详细定位","date":"2024-04-15T07:53:36.000Z","updated":"2024-06-27T03:15:45.598Z","comments":true,"path":"api/articles/uniapp下小程序获取详细定位.json","keywords":"蔡惠霖的博客，前端开发，Vue，Node.js","cover":"https://blog-1300014307.cos.ap-guangzhou.myqcloud.com/gddt.png","content":"<h3 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h3><p>uniapp自带的API&nbsp;&nbsp; <span style=\"background:#a59aca; color:#fff;padding:5px 5px\">uni.getLocation</span>&nbsp;&nbsp;仅APP端支持获取adress，小程序是不支持的。</p>\n<p>\n<p>因此可以借助腾讯/高德的API&nbsp;&nbsp; <span style=\"background:#a59aca; color:#fff;padding:5px 5px\">地理/逆地理编码</span></p>\n\n<h3 id=\"授权地理位置\"><a href=\"#授权地理位置\" class=\"headerlink\" title=\"授权地理位置\"></a>授权地理位置</h3><p><span style=\"background:#a59aca; color:#fff;padding:5px 5px\">manifest.json</span> 该文件中添加以下代码，会弹出位置授权弹框。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&quot;mp-weixin&quot; : &#123;</span><br><span class=\"line\">    &quot;permission&quot; : &#123;</span><br><span class=\"line\">        &quot;scope.userLocation&quot; : &#123;</span><br><span class=\"line\">            &quot;desc&quot; : &quot;将获取你的地址&quot;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>但有些用户可能会选择关闭，因为当进入到需要获取地理位置的的页面时就无法进行定位，因为最好在具体页面再进行一次<em><strong>位置的授权</strong></em></p>\n\n<!-- ![](./location/getLocationAuthority.png) -->\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> getIsAuthority()&#123;</span><br><span class=\"line\">    var that = this;</span><br><span class=\"line\">    uni.getSetting(&#123;</span><br><span class=\"line\">        success: (res) =&gt; &#123;</span><br><span class=\"line\">            if (res.authSetting[&#x27;scope.userLocation&#x27;] != undefined &amp;&amp; res.authSetting[&#x27;scope.userLocation&#x27;] != true) &#123;//非初始化进入该页面,且未授权</span><br><span class=\"line\">            uni.showModal(&#123;</span><br><span class=\"line\">                title: &#x27;是否授权当前位置&#x27;,</span><br><span class=\"line\">                content: &#x27;需要获取您的地理位置，请确认授权，否则地图功能将无法使用&#x27;,</span><br><span class=\"line\">                success: function (res) &#123;</span><br><span class=\"line\">                if (res.cancel) &#123;</span><br><span class=\"line\">                    console.info(&quot;授权失败返回数据&quot;);</span><br><span class=\"line\"></span><br><span class=\"line\">                &#125; else if (res.confirm) &#123;</span><br><span class=\"line\">                    uni.openSetting(&#123;</span><br><span class=\"line\">                        success: function (data) &#123;</span><br><span class=\"line\">                            if (data.authSetting[&quot;scope.userLocation&quot;] == true) &#123;</span><br><span class=\"line\">                            uni.showToast(&#123;</span><br><span class=\"line\">                                title: &#x27;授权成功&#x27;,</span><br><span class=\"line\">                                icon: &#x27;success&#x27;,</span><br><span class=\"line\">                                duration: 5000</span><br><span class=\"line\">                            &#125;)</span><br><span class=\"line\">                            //再次授权，调用getLocationt的API</span><br><span class=\"line\">                            that.getCurrentLocation(that);</span><br><span class=\"line\">                            &#125;else&#123;</span><br><span class=\"line\">                            uni.showToast(&#123;</span><br><span class=\"line\">                                title: &#x27;授权失败&#x27;,</span><br><span class=\"line\">                                icon: &#x27;success&#x27;,</span><br><span class=\"line\">                                duration: 5000</span><br><span class=\"line\">                            &#125;)</span><br><span class=\"line\">                            &#125;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                        &#125;)</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;)</span><br><span class=\"line\">            &#125; else if (res.authSetting[&#x27;scope.userLocation&#x27;] == undefined) &#123;//初始化进入</span><br><span class=\"line\">                that.getCurrentLocation(that);</span><br><span class=\"line\">            &#125;else&#123;</span><br><span class=\"line\">                that.getCurrentLocation(that);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;,</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"腾讯位置服务进行设置\"><a href=\"#腾讯位置服务进行设置\" class=\"headerlink\" title=\"腾讯位置服务进行设置\"></a>腾讯位置服务进行设置</h3><p><a href=\"https://lbs.qq.com/service/webService/webServiceGuide/address/Gcoder\">腾讯位置服务</a></p>\n<p>详细步骤点击链接查看:<a href=\"https://blog.csdn.net/Ronion123/article/details/133887415\">步骤设置</a></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//获取定位</span><br><span class=\"line\">   getCurrentLocation(thatParam) &#123;</span><br><span class=\"line\">       let that = thatParam</span><br><span class=\"line\">       uni.getLocation(&#123;</span><br><span class=\"line\">           type: &#x27;gcj02&#x27;,// (！！！必需)默认为 wgs84 返回 gps 坐标，gcj02（更准确） 返回可用于 uni.openLocation 的坐标</span><br><span class=\"line\">           isHighAccuracy: true,//开启高精度定位(！！！必需)</span><br><span class=\"line\">           success: function(res) &#123;</span><br><span class=\"line\">               that.form.longitude = &quot;经度： &quot; +  res.longitude.toFixed(5) + &quot;  &quot; + &quot;纬度： &quot; + res.latitude.toFixed(5);</span><br><span class=\"line\">               //根据获取的经纬度去解析当前坐标的地址信息</span><br><span class=\"line\">               that.loAcquire(res.longitude, res.latitude)</span><br><span class=\"line\">           &#125;,</span><br><span class=\"line\">           fail: function(error) &#123;</span><br><span class=\"line\">               uni.showToast(&#123;</span><br><span class=\"line\">                   title: &#x27;无法获取位置信息！无法使用位置功能&#x27;,</span><br><span class=\"line\">                   icon: &#x27;none&#x27;,</span><br><span class=\"line\">               &#125;)</span><br><span class=\"line\">           &#125;</span><br><span class=\"line\">       &#125;);</span><br><span class=\"line\">   &#125;,</span><br><span class=\"line\">   //根据获取的经纬度去解析当前坐标的地址信息</span><br><span class=\"line\">   loAcquire(longitude, latitude) &#123;</span><br><span class=\"line\">       let that = this;</span><br><span class=\"line\">       uni.showLoading(&#123;</span><br><span class=\"line\">           title: &#x27;加载中&#x27;,</span><br><span class=\"line\">           mask: true</span><br><span class=\"line\">       &#125;);</span><br><span class=\"line\">       uni.request(&#123;</span><br><span class=\"line\">           url: &#x27;https://apis.map.qq.com/ws/geocoder/v1/?location=&#x27;,</span><br><span class=\"line\">           method: &#x27;GET&#x27;,</span><br><span class=\"line\">           data: &#123;</span><br><span class=\"line\">               key: key,</span><br><span class=\"line\">               location: `$&#123;res.longitude&#125;,$&#123;res.latitude&#125;`</span><br><span class=\"line\">           &#125;,</span><br><span class=\"line\">           success: (e) =&gt; &#123;</span><br><span class=\"line\">           &#125;,</span><br><span class=\"line\">           fail: () =&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">           &#125;</span><br><span class=\"line\">       &#125;)</span><br><span class=\"line\">   &#125;</span><br></pre></td></tr></table></figure>\n","feature":true,"text":"前言uniapp自带的API uni.getLocation 仅APP端支持获取adress，小程序是不支持的。 因此可以借助腾讯/高德的API 地理/逆地理编...","permalink":"/post/uniapp下小程序获取详细定位","photos":[],"count_time":{"symbolsCount":"3.8k","symbolsTime":"3 mins."},"categories":[{"name":"经验","slug":"经验","count":3,"path":"api/categories/经验.json"}],"tags":[{"name":"uniapp小程序","slug":"uniapp小程序","count":1,"path":"api/tags/uniapp小程序.json"},{"name":"地图","slug":"地图","count":1,"path":"api/tags/地图.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%89%8D%E8%A8%80\"><span class=\"toc-text\">前言</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%8E%88%E6%9D%83%E5%9C%B0%E7%90%86%E4%BD%8D%E7%BD%AE\"><span class=\"toc-text\">授权地理位置</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E8%85%BE%E8%AE%AF%E4%BD%8D%E7%BD%AE%E6%9C%8D%E5%8A%A1%E8%BF%9B%E8%A1%8C%E8%AE%BE%E7%BD%AE\"><span class=\"toc-text\">腾讯位置服务进行设置</span></a></li></ol>","author":{"name":"May","slug":"blog-author","avatar":"https://blog-1300014307.cos.ap-guangzhou.myqcloud.com/logo24.png","link":"/","description":"Love Music, love life","socials":{"github":"https://github.com/ShuHongXie","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"Vue.2.6源码分析之响应式数据原理","uid":"e0084657f452526ce5e427bc65b7869d","slug":"Vue.2.6源码分析之响应式数据原理","date":"2024-07-19T16:00:00.000Z","updated":"2024-06-27T03:15:45.597Z","comments":true,"path":"api/articles/Vue.2.6源码分析之响应式数据原理.json","keywords":"蔡惠霖的博客，前端开发，Vue，Node.js","cover":"https://blog-1300014307.cos.ap-guangzhou.myqcloud.com/vue-01.jpg","text":"前言响应式 是 Vue 最独特的特性之一。当修改实例的 data 的属性时，视图会进行更新。vue2 的数据劫持是利用 Object.definePropert...","permalink":"/post/Vue.2.6源码分析之响应式数据原理","photos":[],"count_time":{"symbolsCount":"2.5k","symbolsTime":"2 mins."},"categories":[{"name":"Vue","slug":"Vue","count":1,"path":"api/categories/Vue.json"},{"name":"总结","slug":"Vue/总结","count":1,"path":"api/categories/Vue/总结.json"},{"name":"Vue源码","slug":"Vue/总结/Vue源码","count":1,"path":"api/categories/Vue/总结/Vue源码.json"}],"tags":[{"name":"Vue","slug":"Vue","count":2,"path":"api/tags/Vue.json"}],"author":{"name":"May","slug":"blog-author","avatar":"https://blog-1300014307.cos.ap-guangzhou.myqcloud.com/logo24.png","link":"/","description":"Love Music, love life","socials":{"github":"https://github.com/ShuHongXie","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"旧版本Vuex如何做持久化","uid":"fc0084e39f16c44f947668a585ecf5c2","slug":"Vuex本地持久化","date":"2024-02-10T16:00:00.000Z","updated":"2024-06-07T03:20:18.000Z","comments":true,"path":"api/articles/Vuex本地持久化.json","keywords":"蔡惠霖的博客，前端开发，Vue，Node.js","cover":"https://blog-1300014307.cos.ap-guangzhou.myqcloud.com/20240607111025.png","text":"Vuex如何实现本地持久化？...","permalink":"/post/Vuex本地持久化","photos":[],"count_time":{"symbolsCount":"2.6k","symbolsTime":"2 mins."},"categories":[],"tags":[{"name":"Vue","slug":"Vue","count":2,"path":"api/tags/Vue.json"},{"name":"Vuex","slug":"Vuex","count":1,"path":"api/tags/Vuex.json"}],"author":{"name":"May","slug":"blog-author","avatar":"https://blog-1300014307.cos.ap-guangzhou.myqcloud.com/logo24.png","link":"/","description":"Love Music, love life","socials":{"github":"https://github.com/ShuHongXie","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}