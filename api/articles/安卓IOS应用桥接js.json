{"title":"安卓IOS应用桥接js","uid":"cbaa866e1d73edd3734c218b3bd40e4c","slug":"安卓IOS应用桥接js","date":"2021-02-24T16:00:00.000Z","updated":"2024-06-07T03:20:18.000Z","comments":true,"path":"api/articles/安卓IOS应用桥接js.json","keywords":"蔡惠霖的博客，前端开发，Vue，Node.js","cover":null,"content":"<p>记录下自己公司和 js 友商的 APP 桥接的过程 ## 代码展示</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 环境判断</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> isAndroid = navigator.<span class=\"property\">userAgent</span>.<span class=\"title function_\">indexOf</span>(<span class=\"string\">&#x27;Android&#x27;</span>) &gt; -<span class=\"number\">1</span> || navigator.<span class=\"property\">userAgent</span>.<span class=\"title function_\">indexOf</span>(<span class=\"string\">&#x27;Adr&#x27;</span>) &gt; -<span class=\"number\">1</span>;</span><br><span class=\"line\"><span class=\"comment\">// 初始化桥接</span></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">initBridge</span>(<span class=\"params\">callback</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (isAndroid) &#123;</span><br><span class=\"line\">    <span class=\"comment\">/**安卓端创建桥接*/</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"variable language_\">window</span>.<span class=\"property\">WebViewJavascriptBridge</span>) &#123;</span><br><span class=\"line\">      <span class=\"title function_\">callback</span>(<span class=\"title class_\">WebViewJavascriptBridge</span>);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      <span class=\"variable language_\">document</span>.<span class=\"title function_\">addEventListener</span>(</span><br><span class=\"line\">        <span class=\"string\">&quot;WebViewJavascriptBridgeReady&quot;</span>,</span><br><span class=\"line\">        <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">          <span class=\"title function_\">callback</span>(<span class=\"title class_\">WebViewJavascriptBridge</span>);</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"literal\">false</span></span><br><span class=\"line\">      );</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">/**苹果端创建桥接*/</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"variable language_\">window</span>.<span class=\"property\">WebViewJavascriptBridge</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"title function_\">callback</span>(<span class=\"title class_\">WebViewJavascriptBridge</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"variable language_\">window</span>.<span class=\"property\">WVJBCallbacks</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"variable language_\">window</span>.<span class=\"property\">WVJBCallbacks</span>.<span class=\"title function_\">push</span>(callback);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"variable language_\">window</span>.<span class=\"property\">WVJBCallbacks</span> = [callback];</span><br><span class=\"line\">    <span class=\"keyword\">const</span> <span class=\"title class_\">WVJBIframe</span> = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&quot;iframe&quot;</span>);</span><br><span class=\"line\">    <span class=\"title class_\">WVJBIframe</span>.<span class=\"property\">style</span>.<span class=\"property\">display</span> = <span class=\"string\">&quot;none&quot;</span>;</span><br><span class=\"line\">    <span class=\"title class_\">WVJBIframe</span>.<span class=\"property\">src</span> = <span class=\"string\">&quot;wvjbscheme://__BRIDGE_LOADED__&quot;</span>;</span><br><span class=\"line\">    <span class=\"variable language_\">document</span>.<span class=\"property\">documentElement</span>.<span class=\"title function_\">appendChild</span>(<span class=\"title class_\">WVJBIframe</span>);</span><br><span class=\"line\">    <span class=\"built_in\">setTimeout</span>(<span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">      <span class=\"variable language_\">document</span>.<span class=\"property\">documentElement</span>.<span class=\"title function_\">removeChild</span>(<span class=\"title class_\">WVJBIframe</span>);</span><br><span class=\"line\">    &#125;, <span class=\"number\">0</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"title function_\">initBridge</span>(<span class=\"function\">(<span class=\"params\">bridge</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 调用Native方法</span></span><br><span class=\"line\">  bridge.<span class=\"title function_\">callHandler</span>(方法名, 参数, <span class=\"function\">(<span class=\"params\">res</span>) =&gt;</span> &#123;...执行对应操作&#125;);</span><br><span class=\"line\">  <span class=\"comment\">// 注册方法</span></span><br><span class=\"line\">  bridge.<span class=\"title function_\">registerHandler</span>(方法名, <span class=\"function\">(<span class=\"params\">res</span>) =&gt;</span> &#123;...执行对应操作&#125;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n","text":"记录下自己公司和 js 友商的 APP 桥接的过程 ## 代码展示 1234567891011121314151617181920212223242526272...","permalink":"/post/安卓IOS应用桥接js","photos":[],"count_time":{"symbolsCount":"1.5k","symbolsTime":"1 mins."},"categories":[],"tags":[{"name":"APP","slug":"APP","count":1,"path":"api/tags/APP.json"}],"toc":"","author":{"name":"谢小谢","slug":"blog-author","avatar":"https://blog-1300014307.cos.ap-guangzhou.myqcloud.com/logo24.png","link":"/","description":"Love Music, love life","socials":{"github":"https://github.com/ShuHongXie","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"Dcloud的Canvas插件二次改写为Vue模板","uid":"ed256b7d0dc1c9858a4d40687aeaf04d","slug":"Dcloud的Canvas插件二次改写为Vue模板","date":"2021-06-30T16:00:00.000Z","updated":"2024-06-07T03:20:18.000Z","comments":true,"path":"api/articles/Dcloud的Canvas插件二次改写为Vue模板.json","keywords":"蔡惠霖的博客，前端开发，Vue，Node.js","cover":"https://www.xiesmallxie.cn/canvas_drawer.jpg","text":"由于公司用的海报图插件都是使用的canvas_drawer插件来绘制海报图，由于是 18 年的插件，且只支持微信小程序原生语法。如果有其他客户端小程序的要求下是...","permalink":"/post/Dcloud的Canvas插件二次改写为Vue模板","photos":[],"count_time":{"symbolsCount":"11k","symbolsTime":"10 mins."},"categories":[{"name":"uni-app","slug":"uni-app","count":3,"path":"api/categories/uni-app.json"}],"tags":[{"name":"uni-app","slug":"uni-app","count":4,"path":"api/tags/uni-app.json"},{"name":"canvas","slug":"canvas","count":3,"path":"api/tags/canvas.json"}],"author":{"name":"谢小谢","slug":"blog-author","avatar":"https://blog-1300014307.cos.ap-guangzhou.myqcloud.com/logo24.png","link":"/","description":"Love Music, love life","socials":{"github":"https://github.com/ShuHongXie","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"组件库按需加载声明文件(d.ts)编写","uid":"042d33a635bea50f9dee5448c961536b","slug":"组件库按需加载声明文件(d.ts)编写","date":"2021-02-22T16:00:00.000Z","updated":"2024-06-07T03:20:18.000Z","comments":true,"path":"api/articles/组件库按需加载声明文件(d.ts)编写.json","keywords":"蔡惠霖的博客，前端开发，Vue，Node.js","cover":"https://blog-1300014307.cos.ap-guangzhou.myqcloud.com/fat01.jpg","text":"前言自己的 Fat-ui 组件库和 babel 按需加载插件写完之后，也抽空把 d.ts 声明文件一起做了，现在将编写和配置过程记录下来 第一步 首先分析下 V...","permalink":"/post/组件库按需加载声明文件(d.ts)编写","photos":[],"count_time":{"symbolsCount":"1.3k","symbolsTime":"1 mins."},"categories":[{"name":"库相关","slug":"库相关","count":1,"path":"api/categories/库相关.json"},{"name":"经验","slug":"库相关/经验","count":1,"path":"api/categories/库相关/经验.json"}],"tags":[{"name":"Vue","slug":"Vue","count":8,"path":"api/tags/Vue.json"},{"name":"组件库","slug":"组件库","count":2,"path":"api/tags/组件库.json"}],"author":{"name":"谢小谢","slug":"blog-author","avatar":"https://blog-1300014307.cos.ap-guangzhou.myqcloud.com/logo24.png","link":"/","description":"Love Music, love life","socials":{"github":"https://github.com/ShuHongXie","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}